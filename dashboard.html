<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Comida Sobrante</title>
    <link rel="stylesheet" href="assets/styles.css">
</head>
<body>
    <header>
        <div class="logo">
            <h1>Dashboard - Comida Sobrante</h1>
            <p>Panel de administración - <span id="welcome-user">Bienvenido</span></p>
        </div>
        <nav>
            <ul>
                <li><a href="#" aria-label="Ir a inicio">Inicio</a></li>
                <li><a href="#" aria-label="Ver ventas">Ventas</a></li>
                <li><a href="#" aria-label="Ver impacto">Impacto</a></li>
                <li><a href="#" aria-label="Gestionar usuarios">Usuarios</a></li>
                <li><a href="#" id="logout-btn" aria-label="Cerrar sesión">Cerrar sesión</a></li>
            </ul>
        </nav>
    </header>

    <main>
        <!-- Hero Section -->
        <section class="hero">
            <h2>Bienvenido al Dashboard</h2>
            <p>Monitorea el impacto de tu plataforma de comida sobrante y observa los resultados en tiempo real.</p>
            <a href="#statistics" class="btn" aria-label="Ver estadísticas detalladas">Ver Datos</a>
        </section>

        <!-- Statistics Section -->
        <section id="statistics" class="benefits">
            <h2>Estadísticas de Impacto</h2>
            <div class="benefits-container">
                <div class="benefit">
                    <h3 id="waste-reduced">Cargando...</h3>
                    <p>Desperdicio de comida reducido este mes</p>
                </div>
                <div class="benefit">
                    <h3 id="money-saved">Cargando...</h3>
                    <p>Ahorros generados para los consumidores</p>
                </div>
                <div class="benefit">
                    <h3 id="active-users">Cargando...</h3>
                    <p>Usuarios activos en la plataforma</p>
                </div>
            </div>
        </section>

        <!-- Features Section -->
        <section class="benefits">
            <h2>Características de la Plataforma</h2>
            <div class="benefits-container">
                <div class="benefit">
                    <h3>Reducción de Desperdicio</h3>
                    <p>Ayuda a disminuir el desperdicio alimentario con cada venta realizada en la plataforma.</p>
                </div>
                <div class="benefit">
                    <h3>Ahorro Económico</h3>
                    <p>Los consumidores pueden acceder a alimentos de calidad a precios significativamente reducidos.</p>
                </div>
                <div class="benefit">
                    <h3>Impacto Ambiental</h3>
                    <p>Contribuye a la reducción de la huella de carbono generada por el desperdicio de alimentos.</p>
                </div>
            </div>
        </section>

        <!-- Management Section -->
        <section class="benefits">
            <h2>Gestión de la Plataforma</h2>
            <div class="benefits-container">
                <div class="benefit">
                    <h3>Gestión de Productos</h3>
                    <p>Administra el inventario de productos disponibles y sus precios.</p>
                    <a href="#" class="btn" style="margin-top: 15px;">Gestionar Productos</a>
                </div>
                <div class="benefit">
                    <h3>Reportes y Analytics</h3>
                    <p>Accede a reportes detallados sobre ventas, usuarios e impacto ambiental.</p>
                    <a href="#" class="btn" style="margin-top: 15px;">Ver Reportes</a>
                </div>
                <div class="benefit">
                    <h3>Configuración</h3>
                    <p>Configura parámetros de la plataforma y preferencias del sistema.</p>
                    <a href="#" class="btn" style="margin-top: 15px;">Configurar</a>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer Section -->
    <footer>
        <p>&copy; 2025 Proyecto Comida Sobrante. Todos los derechos reservados.</p>
    </footer>

    <script>
        // Verificar autenticación al cargar la página
        window.addEventListener('load', () => {
            checkAuthentication();
            displayWelcomeMessage();
            loadDashboardData();
        });

        // Función para verificar autenticación
        function checkAuthentication() {
            const isLoggedIn = localStorage.getItem('isLoggedIn');
            const loginTime = localStorage.getItem('loginTime');
            
            if (!isLoggedIn || isLoggedIn !== 'true') {
                alert('Debes iniciar sesión para acceder al dashboard.');
                window.location.href = 'login.html';
                return;
            }
            
            // Verificar si la sesión no ha expirado (opcional: expira después de 24 horas)
            if (loginTime) {
                const currentTime = new Date().getTime();
                const sessionDuration = 24 * 60 * 60 * 1000; // 24 horas en milisegundos
                
                if (currentTime - parseInt(loginTime) > sessionDuration) {
                    alert('Tu sesión ha expirado. Por favor, inicia sesión nuevamente.');
                    logout();
                    return;
                }
            }
            
            console.log('Usuario autenticado correctamente');
        }

        // Mostrar mensaje de bienvenida personalizado
        function displayWelcomeMessage() {
            const username = localStorage.getItem('username');
            const welcomeElement = document.getElementById('welcome-user');
            
            if (username && welcomeElement) {
                welcomeElement.textContent = `Bienvenido, ${username}`;
            }
        }

        // Cargar datos del dashboard
        async function loadDashboardData() {
            try {
                // Simular carga de datos del servidor
                // En una implementación real, harías fetch a tu API
                setTimeout(() => {
                    updateStatistics({
                        wasteReduced: Math.floor(Math.random() * 2000) + 1000,
                        moneySaved: Math.floor(Math.random() * 5000) + 2000,
                        activeUsers: Math.floor(Math.random() * 800) + 200
                    });
                }, 1000);
                
            } catch (error) {
                console.error('Error loading dashboard data:', error);
                // Mostrar datos por defecto en caso de error
                updateStatistics({
                    wasteReduced: 1250,
                    moneySaved: 3420,
                    activeUsers: 486
                });
            }
        }

        // Actualizar estadísticas en el dashboard
        function updateStatistics(data) {
            const wasteElement = document.getElementById('waste-reduced');
            const moneyElement = document.getElementById('money-saved');
            const usersElement = document.getElementById('active-users');

            if (wasteElement) {
                wasteElement.textContent = `${data.wasteReduced.toLocaleString()} kg`;
            }
            if (moneyElement) {
                moneyElement.textContent = `$${data.moneySaved.toLocaleString()}`;
            }
            if (usersElement) {
                usersElement.textContent = data.activeUsers.toLocaleString();
            }
        }

        // Manejar cierre de sesión
        document.getElementById('logout-btn').addEventListener('click', (e) => {
            e.preventDefault();
            
            if (confirm('¿Estás seguro de que deseas cerrar sesión?')) {
                logout();
            }
        });

        // Función de logout
        function logout() {
            // Limpiar todos los datos de sesión
            localStorage.removeItem('isLoggedIn');
            localStorage.removeItem('userId');
            localStorage.removeItem('username');
            localStorage.removeItem('loginTime');
            
            // Limpiar cualquier otro dato de sesión
            sessionStorage.clear();
            
            // Redirigir al login
            alert('Sesión cerrada exitosamente.');
            window.location.href = 'login.html';
        }

        // Actualizar estadísticas cada 30 segundos
        setInterval(loadDashboardData, 30000);

        // Prevenir acceso directo a la página sin autenticación
        if (localStorage.getItem('isLoggedIn') !== 'true') {
            window.location.href = 'login.html';
        }
    </script>
</body>
</html>